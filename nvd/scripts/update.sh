#!/bin/bash -l

mkdir .tmp

xh GET https://nvd.nist.gov/feeds/xml/cpe/dictionary/official-cpe-dictionary_v2.3.xml.gz --download --output .tmp/official-cpe-dictionary_v2.3.xml.gz
gzip --decompress --force .tmp/official-cpe-dictionary_v2.3.xml.gz

crane export ghcr.io/anchore/grype-db/data/nvd:latest - | tar -Oxf - nvd/input/nvd-input.db > .tmp/nvd-input.db
crane export ghcr.io/anchore/grype-db/data/nvd:latest - | tar -Oxf - nvd/results/results.db > .tmp/nvd-result.db
crane export ghcr.io/anchore/grype-db/data/github:latest - | tar -Oxf - github/results/results.db > .tmp/github-result.db

git -C national-vulnerability-database pull origin main
git -C cvelist-v5 pull upstream main
git -C linux-kernel-vulns pull origin master

rm -rf .tmp/github-advisory-database
git clone --depth 1 git@github.com:github/advisory-database.git .tmp/github-advisory-database
