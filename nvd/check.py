import os
import json
from glob import glob
from cpe import CPE

for enriched_file in glob("/Users/weston/github/anchore/cve-data-enrichment/data/anchore/**/CVE-*.json"):
    with open(enriched_file) as f:
        enriched = json.load(f)

    for affected in enriched["adp"].get("affected", []):
        cpes = affected.get("cpes")

        if not cpes:
            print(f"missing cpes for {enriched_file}")
            continue

        for cpe in cpes:
            try:
                #print(cpe)
                c = CPE(cpe)
            except Exception:
                print(f"cpe {cpe} invalid for {enriched_file}")