package main

import (
	"os"
	"path"
	"testing"

	"github.com/stretchr/testify/require"

	"github.com/anchore/go-sync"
	"github.com/anchore/vulnerability-data-tools/cve-text-analyzer/internal/util"
)

func Test_process(t *testing.T) {
	wd, err := os.Getwd()
	require.NoError(t, err)
	dbFile := path.Join(wd, "testdata", "results.db")
	cveListDir := path.Join(wd, "testdata", "cves")

	indexes := processInputsToIndexes(sync.NewExecutor(0), dbFile, cveListDir)

	searchTerms := util.GetTextTerms("road-runner has a set of terms with a unique vulnerability")
	matches := indexes.LookupProduct(searchTerms)

	require.Len(t, matches, 3)
	require.Equal(t, "cpe:2.3:a:acme:road_runner:*:*:*:*:*:platypus:*:*", matches[0].Product.ID)
}
